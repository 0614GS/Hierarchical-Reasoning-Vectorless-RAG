{"node_id": "31d5c7", "title": "Use a virtual filesystem", "path": "backends > Backends > Use a virtual filesystem", "content": "Build a custom backend to project a remote or database filesystem (e.g., S3 or Postgres) into the tools namespace.\n\nDesign guidelines:\n\n* Paths are absolute (`/x/y.txt`). Decide how to map them to your storage keys/rows.\n* Implement `ls_info` and `glob_info` efficiently (server-side listing where available, otherwise local filter).\n* Return user-readable error strings for missing files or invalid regex patterns.\n* For external persistence, set `files_update=None` in results; only in-state backends should return a `files_update` dict.\n\nS3-style outline:\n\n```python  theme={null}\nfrom deepagents.backends.protocol import BackendProtocol, WriteResult, EditResult\nfrom deepagents.backends.utils import FileInfo, GrepMatch\n\nclass S3Backend(BackendProtocol):\n    def __init__(self, bucket: str, prefix: str = \"\"):\n        self.bucket = bucket\n        self.prefix = prefix.rstrip(\"/\")\n\n    def _key(self, path: str) -> str:\n        return f\"{self.prefix}{path}\"\n\n    def ls_info(self, path: str) -> list[FileInfo]:\n        # List objects under _key(path); build FileInfo entries (path, size, modified_at)\n        ...\n\n    def read(self, file_path: str, offset: int = 0, limit: int = 2000) -> str:\n        # Fetch object; return numbered content or an error string\n        ...\n\n    def grep_raw(self, pattern: str, path: str | None = None, glob: str | None = None) -> list[GrepMatch] | str:\n        # Optionally filter server‑side; else list and scan content\n        ...\n\n    def glob_info(self, pattern: str, path: str = \"/\") -> list[FileInfo]:\n        # Apply glob relative to path across keys\n        ...\n\n    def write(self, file_path: str, content: str) -> WriteResult:\n        # Enforce create‑only semantics; return WriteResult(path=file_path, files_update=None)\n        ...\n\n    def edit(self, file_path: str, old_string: str, new_string: str, replace_all: bool = False) -> EditResult:\n        # Read → replace (respect uniqueness vs replace_all) → write → return occurrences\n        ...\n```\n\nPostgres-style outline:\n\n* Table `files(path text primary key, content text, created_at timestamptz, modified_at timestamptz)`\n* Map tool operations onto SQL:\n  * `ls_info` uses `WHERE path LIKE $1 || '%'`\n  * `glob_info` filter in SQL or fetch then apply glob in Python\n  * `grep_raw` can fetch candidate rows by extension or last modified time, then scan lines", "summary": "Design and implement a custom backend to integrate remote or database filesystems into the tools namespace, with examples for S3 and Postgres.", "keywords": ["virtual filesystem", "custom backend", "S3", "Postgres", "ls_info", "glob_info", "BackendProtocol", "FileInfo", "GrepMatch"]}